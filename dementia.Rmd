---
title: "Dementia"
author: "Examination Number: Y3866839"
date: "30/11/2020"
output: 
  bookdown::html_document2: default
bibliography: references/references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      message = FALSE,
                      fig.retina = 3)

library(tidyverse)
library(magrittr)
library(dplyr)
library(knitr)
library(readxl)
```

## Introduction{-}
Clinical visit data was collected from 150 subjects aged between 60 and 96. Data collected included the subjects age, gender, years of education and socioeconomic status (assessed by the Hollingshead Index of Social Position). Each subject underwent MRIs on at least two separate visits (over one year apart) in order to assess estimated intracranial volume and normalised whole brain volume. They were also given a score at each visit for the Mini-Mental State Examination (MMSE), that is used in clinical practise to measure cognitive impairment, and were given a Clinical Dementia Rating. 

The Clinical Dementia Rating (CDR) is a global rating device, first introduced in 1982. It is calculated on the basis of testing six cognitive and behavioural domains such as memory, orientation, judgment, problem solving, community affairs, home and hobbies and personal care. It is based on a five point scale of 0-3; 0 = no dementia, 0.5 = questionable dementia, 1 = mild cognitive impairment/ mild dementia, 2 = moderate cognitive impairment/ moderate dementia and 3 = severe cognitive impairment/ severe dementia [@Morris1997].

The analysis performed here will combine the patient and clinical visit data and tidy this into a format suitable for analysis. Then I aim to determine whether Clinical Dementia Rating can be predicted based on a number of other factors (SAY WHAT THESE ARE!!) using supervised methods of machine learning. I will also assess which machine learning method is able to most accurately predict CDR. 

Analysis was conducted in R [@Rbase] using Rmarkdown [@Allaire2020; @Xie2018; @Xie2020]

## Data Import{-}
```{r data import}
#Read in the patient data and the visit data as two separate .txt files 

patient <- read_excel("data_raw/patient_data.xlsx")

visit <- read_excel("data_raw/visit_data.xlsx")
```

Clinical visit data and patient data were stored in two separate Excel spreadsheets. These were read into R separately so that (?????) they could first be tidied separately. This is necessary as there are only 150 observations in the patient data, whereas there are 373 observations in the visit data, as each patient had 2 or 3 separate MRI scans.

<!-- MAKE THIS SOUND BETTER -->

## Data Tidying{-}

```{r data tidy, include = FALSE}

#Change the headings in patient data to a tidy format
#look at existing column names
colnames(patient)

#create and assign new column names
colnames_patient <- c("subject_ID", "group", "sex", "years_of_education", "socioeconomic_status")
names(patient) <- colnames_patient

#Change headings in the visit data to more meaningful names and to a tidy format
#look at existing column names
colnames(visit)

#create and assign new column names
colnames_visit <- c("subject_ID", "MRI_number", "visit", "age", "MMSE_score", "CDR", "intracranial_volume", "whole_brain_volume", "atlas_scaling_factor")
names(visit) <- colnames_visit

#Join the patient data and visit data tables together using inner join. this function compared to others (do a google) enables you to duplicate the patient data rows to joing together based on subject id. you can multiply the patient data so same no obs.
dementia <- inner_join(patient, visit, by = "subject_ID", copy = FALSE, suffix = c(".x", ".y"))

#Several subjects do not have a score for socioeconomic status. As I am doing machine learning and want to determine whether we can predict CDR from the different variables I need each variable to have a value for every subject. 
#Hence need to remove NAs

#Determine if there are any NA values
any(is.na(dementia))
#Output is true - this shows me that somewhere in the dataframe there are NA values. 
which(is.na(dementia))
#This shows me that there are 21 observations that have an NA value for one of the variables
#From a quick scan through the dataset I suspect that the missing values are in the socioeconomic status column. 
which(is.na(dementia$socioeconomic_status))
#I can see that 19 of the NAs are in the socioeconomic status column. 
#The other two were found to be in MMSE score
which(is.na(dementia$MMSE_score))

#We want to remove all the observations which contain an NA value for one or more variables
dementia_no_na <- na.omit(dementia)

which(is.na(dementia_no_na))
#Proves that there are no more NA values in the dataset

#Make the subject IDs a bit nicer?

#Extract one observation/subject ID to work with 
one_subject_ID <- dementia_no_na$subject_ID[1]

one_subject_ID

one_subject_ID %>% 
  str_replace("OAS2_0", "")

#Apply to the whole column

dementia_no_na$subject_ID %>% 
  str_replace("OAS2_0", "")

dementia_tidy <- dementia_no_na %>% 
  mutate(subject_ID = subject_ID %>% 
           str_replace("OAS2_0", ""))

```
<!-- Write about what you did here and why? What specific functions and why those ones not others? -->

## Data summary{-}

<!-- when you do the machine learning - do not include visit number! That is not a determining factor??? -->
## LDA{-}

## Random Forest{-}

## Conclusion{-}
```{r wordcount}
wordcount <- wordcountaddin::word_count("scripts/dementia.Rmd")
#current wordcount is 256
```
**Wordcount:** `r wordcount`

## References{-}
